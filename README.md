# å‰§æƒ…å°è¯´æµ·è±¹æ’ä»¶å¯è§†åŒ–ç¼–è¾‘å™¨

è¿™æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„å‰§æƒ…/è·‘å›¢æ’ä»¶ç¼–è¾‘å™¨ï¼Œä¸“ä¸º **SealDice (æµ·è±¹æ ¸å¿ƒ)** è®¾è®¡ã€‚ä½ å¯ä»¥é€šè¿‡æ‹–æ‹½èŠ‚ç‚¹æ¥åˆ›ä½œäº’åŠ¨å°è¯´ã€RPG å‰§æœ¬ï¼Œå¹¶ä¸€é”®ç”Ÿæˆå¯ç”¨çš„ JS æ’ä»¶ã€‚

è¿™æ˜¯ä¼Ÿå¤§çš„AIæ‰€å®Œæˆçš„å¤§éƒ¨åˆ†é€»è¾‘ï¼Œæˆ‘åªæ˜¯ä¸€ä¸ªæµ‹è¯•å‘˜å’Œå¾®è°ƒè€….jpg

## åŠŸèƒ½ç‰¹æ€§

*   **å¯è§†åŒ–æµå¼ç¼–è¾‘**ï¼šé€šè¿‡æ‹–æ‹½èŠ‚ç‚¹ã€è¿çº¿ï¼ˆæ”¯æŒç®­å¤´æŒ‡å‘ï¼‰å³å¯æ„å»ºå¤æ‚çš„å‰§æƒ…é€»è¾‘ã€‚
*   **ä¸°å¯Œçš„èŠ‚ç‚¹ç±»å‹**ï¼š
    *   **å‰§æƒ…èŠ‚ç‚¹ (Story)**ï¼šå±•ç¤ºæ–‡æœ¬ï¼Œæ”¯æŒæ•°å€¼/ç‰©å“å˜æ›´ï¼ˆæ”¯æŒéª°ç‚¹è¡¨è¾¾å¼ï¼Œå¦‚ `è·å¾— 1d10 é‡‘å¸`ï¼‰ã€‚
    *   **é€‰é¡¹èŠ‚ç‚¹ (Choice)**ï¼šæä¾›åˆ†æ”¯é€‰é¡¹ï¼Œè®©ç©å®¶å†³å®šèµ°å‘ï¼Œé€‰é¡¹ä¹Ÿå¯é™„å¸¦å¥–åŠ±/æƒ©ç½šã€‚
    *   **åˆ¤å®šèŠ‚ç‚¹ (Condition)**ï¼š
        *   **é€»è¾‘åˆ¤å®š**ï¼šæ ¹æ®å±æ€§æ•°å€¼æˆ–ç‰©å“æ‹¥æœ‰æƒ…å†µè‡ªåŠ¨åˆ†æ­§ï¼ˆä¾‹å¦‚ï¼šå¥½æ„Ÿåº¦ > 10ï¼‰ã€‚
        *   **éª°ç‚¹åˆ¤å®š**ï¼šæ¨¡æ‹Ÿè·‘å›¢æ£€å®šï¼ˆå¦‚ `1d100 <= æ•æ·`ï¼‰ï¼Œæ”¯æŒå¤§æˆåŠŸ/å¤§å¤±è´¥/æˆåŠŸ/å¤±è´¥å››ç§åˆ†æ”¯ã€‚
*   **å…¨å±€è§„åˆ™é…ç½®**ï¼šæ”¯æŒè‡ªå®šä¹‰å…¨å±€éª°ç‚¹è§„åˆ™ï¼ˆCoCæ¨¡å¼/D&Dæ¨¡å¼ï¼Œå¤§æˆåŠŸ/å¤§å¤±è´¥é˜ˆå€¼ï¼Œé»˜è®¤æ£€å®šéª°ï¼‰ã€‚
*   **ä¸€é”®ç”Ÿæˆæ’ä»¶**ï¼šè‡ªåŠ¨ç”Ÿæˆæ ‡å‡†çš„ SealDice JavaScript æ’ä»¶ï¼Œæ— éœ€ç¼–å†™ä»»ä½•ä»£ç ã€‚
*   **å·¥ç¨‹ç®¡ç†**ï¼šæ”¯æŒä¿å­˜/è¯»å– JSON å·¥ç¨‹æ–‡ä»¶ï¼Œæ”¯æŒä»ç¤ºä¾‹å·¥ç¨‹å¿«é€Ÿå¼€å§‹ã€‚
*   **ç§»åŠ¨ç«¯é€‚é…**ï¼šä¼˜åŒ–äº†åœ¨æ‰‹æœº/å¹³æ¿ä¸Šçš„æ˜¾ç¤ºå’Œæ“ä½œä½“éªŒã€‚

## å¿«é€Ÿå¼€å§‹

### 1. åœ¨çº¿ä½¿ç”¨
[Github Pages](https://baiyu-yu.github.io/story-sealdicejs-editor/)

### 2. æœ¬åœ°è¿è¡Œ

å¦‚æœä½ æ˜¯å¼€å‘è€…æˆ–å¸Œæœ›æœ¬åœ°è¿è¡Œï¼š

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨ç¼–è¾‘å™¨
npm run dev
```

æµè§ˆå™¨æ‰“å¼€ http://localhost:5173 å³å¯ä½¿ç”¨ã€‚

## ä½¿ç”¨æ•™ç¨‹

1.  **åˆ›å»ºèŠ‚ç‚¹**ï¼šç‚¹å‡»å·¦ä¸Šè§’çš„å·¥å…·æ æ·»åŠ â€œå‰§æƒ…â€ã€â€œé€‰é¡¹â€æˆ–â€œåˆ¤å®šâ€èŠ‚ç‚¹ã€‚
2.  **ç¼–è¾‘å†…å®¹**ï¼šç‚¹å‡»èŠ‚ç‚¹ï¼Œåœ¨åº•éƒ¨/ä¾§è¾¹é¢æ¿ä¿®æ”¹æ–‡æœ¬ã€æ“ä½œæˆ–æ¡ä»¶ã€‚
    *   **æ•°å€¼å˜æ›´**ï¼šé€‰æ‹©å±æ€§åã€æ“ä½œç¬¦ï¼Œè¾“å…¥æ•°å€¼æˆ–è¡¨è¾¾å¼ï¼ˆå¦‚ `1d6+5`ï¼‰ã€‚
    *   **åˆ¤å®šè®¾ç½®**ï¼šåœ¨åˆ¤å®šèŠ‚ç‚¹ä¸­åˆ‡æ¢â€œé€»è¾‘åˆ¤å®šâ€æˆ–â€œéª°ç‚¹åˆ¤å®šâ€æ¨¡å¼ã€‚
     *   **å­˜æ¡£ç‚¹è®¾ç½®**ï¼šåœ¨èŠ‚ç‚¹å±æ€§ä¸­è®¾ç½® `å­˜æ¡£ç‚¹ ID` (Save Point ID)ã€‚å½“ç©å®¶åˆ°è¾¾è¯¥èŠ‚ç‚¹æ—¶ï¼Œè¿›åº¦ä¼šè‡ªåŠ¨ä¿å­˜ã€‚ç©å®¶å¯ä»¥ä½¿ç”¨ `.<æŒ‡ä»¤> load <id>` è¯»å–å­˜æ¡£ã€‚
3.  **è¿æ¥èŠ‚ç‚¹**ï¼šä»ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹æ–¹/å³ä¾§ç‚¹ç‚¹æ‹–æ‹½è¿çº¿åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸Šæ–¹ç‚¹ç‚¹ã€‚
4.  **è®¾ç½®æ’ä»¶ä¿¡æ¯**ï¼šç‚¹å‡»â€œè®¾ç½®â€æŒ‰é’®ï¼Œé…ç½®æ’ä»¶åç§°ã€è§¦å‘æŒ‡ä»¤ï¼ˆå¦‚ `story`ï¼‰åŠå…¨å±€éª°ç‚¹è§„åˆ™ã€‚
5.  **ç”Ÿæˆæ’ä»¶**ï¼šç‚¹å‡»â€œç”Ÿæˆæ’ä»¶â€ï¼Œä¸‹è½½ `.js` æ–‡ä»¶ã€‚
6.  **å®‰è£…åˆ°æµ·è±¹**ï¼šå°† `.js` æ–‡ä»¶æ”¾å…¥ SealDice çš„ `data/scripts` ç›®å½•ï¼Œæˆ–ç›´æ¥åœ¨webuiç‚¹å‡»ä¸Šä¼ ï¼Œé‡è½½ JS å³å¯ã€‚

## ç¤ºä¾‹å·¥ç¨‹

ç¼–è¾‘å™¨å†…ç½®äº†ä¸€ä¸ª `TavernTales`ï¼ˆé…’é¦†ä¼ è¯´ï¼‰ç¤ºä¾‹å·¥ç¨‹ã€‚ç‚¹å‡»ç¼–è¾‘å™¨å³ä¸Šè§’çš„ **"ç¤ºä¾‹"** æŒ‰é’®å³å¯åŠ è½½ã€‚è¯¥ç¤ºä¾‹å±•ç¤ºäº†ï¼š
*   åŸºæœ¬çš„å¯¹è¯åˆ†æ”¯ã€‚
*   å±æ€§ï¼ˆHPã€é‡‘å¸ï¼‰å’Œç‰©å“ï¼ˆç©ºé…’æ¯ï¼‰çš„å¢å‡ã€‚
*   éª°ç‚¹æ£€å®šï¼ˆæ•æ·æ£€å®šå·çªƒè—å®å›¾ï¼‰ã€‚
*   éšæœºæ•°å€¼å¥–åŠ±ã€‚

## é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜

ç¼–è¾‘å™¨ä½¿ç”¨ JSON æ ¼å¼ä¿å­˜å·¥ç¨‹æ–‡ä»¶ï¼ŒåŒ…å« `nodes`ï¼ˆèŠ‚ç‚¹ï¼‰ã€`edges`ï¼ˆè¿æ¥ï¼‰å’Œ `settings`ï¼ˆè®¾ç½®ï¼‰ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ã€‚

### æ•´ä½“ç»“æ„

```json
{
  "nodes": [],
  "edges": [],
  "settings": {}
}
```

### 1. Nodesï¼ˆèŠ‚ç‚¹ï¼‰

èŠ‚ç‚¹æ˜¯å‰§æƒ…æµç¨‹çš„åŸºæœ¬å•å…ƒï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼š`story`ï¼ˆå‰§æƒ…ï¼‰ã€`choice`ï¼ˆé€‰é¡¹ï¼‰ã€`condition`ï¼ˆåˆ¤å®šï¼‰ã€‚

#### å…±åŒå±æ€§

```json
{
  "id": "å”¯ä¸€æ ‡è¯†ç¬¦",
  "type": "story|choice|condition",
  "position": { "x": åæ ‡, "y": åæ ‡ },
  "data": { ... }
}
```

#### Story èŠ‚ç‚¹ï¼ˆå‰§æƒ…èŠ‚ç‚¹ï¼‰

ç”¨äºå±•ç¤ºå‰§æƒ…æ–‡æœ¬å¹¶æ‰§è¡Œå±æ€§/ç‰©å“å˜æ›´ã€‚

```json
{
  "id": "story1",
  "type": "story",
  "position": { "x": 250, "y": 50 },
  "data": {
    "label": "èŠ‚ç‚¹æ ‡ç­¾",
    "text": "å‰§æƒ…æ–‡æœ¬å†…å®¹\næ”¯æŒå¤šè¡Œ",
    "savePointId": "checkpoint_1", // å¯é€‰ï¼šå­˜æ¡£ç‚¹IDï¼Œåˆ°è¾¾æ­¤èŠ‚ç‚¹è‡ªåŠ¨å­˜æ¡£
    "isStart": true,  // æ˜¯å¦ä¸ºèµ·å§‹èŠ‚ç‚¹
    "actions": [      // æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨
      // æ•°å€¼å±æ€§å˜æ›´
      { "type": "stat", "target": "å±æ€§å", "operation": "+", "value": "1d10" },
      // ç‰©å“å˜æ›´
      { "type": "item", "target": "ç‰©å“å", "operation": "+", "value": 1 }
    ]
  }
}
```

**Actions å±æ€§è¯´æ˜ï¼š**
- `type`: `stat`ï¼ˆæ•°å€¼å±æ€§ï¼‰æˆ– `item`ï¼ˆç‰©å“ï¼‰
- `target`: å±æ€§åæˆ–ç‰©å“å
- `operation`: æ“ä½œç¬¦ `=`, `+`, `-`, `*`, `/`
- `value`: æ•°å€¼æˆ–éª°ç‚¹è¡¨è¾¾å¼ï¼ˆå¦‚ `1d10+5`ï¼‰

#### Choice èŠ‚ç‚¹ï¼ˆé€‰é¡¹èŠ‚ç‚¹ï¼‰

æä¾›åˆ†æ”¯é€‰é¡¹ï¼Œè®©ç©å®¶é€‰æ‹©å‰§æƒ…èµ°å‘ã€‚

```json
{
  "id": "choice1",
  "type": "choice",
  "position": { "x": 250, "y": 250 },
  "data": {
    "label": "èŠ‚ç‚¹æ ‡ç­¾",
    "text": "é€‰é¡¹å‰çš„æè¿°æ–‡æœ¬",
    "choices": [
      {
        "id": "opt1",
        "text": "é€‰é¡¹æ–‡æœ¬",
        "actions": []  // é€‰æ‹©æ­¤é€‰é¡¹æ—¶æ‰§è¡Œçš„æ“ä½œ
      }
    ]
  }
}
```

#### Condition èŠ‚ç‚¹ï¼ˆåˆ¤å®šèŠ‚ç‚¹ï¼‰

æ ¹æ®æ¡ä»¶è‡ªåŠ¨åˆ†æ”¯ï¼Œæ”¯æŒé€»è¾‘åˆ¤å®šå’Œéª°ç‚¹åˆ¤å®šä¸¤ç§æ¨¡å¼ã€‚

##### é€»è¾‘åˆ¤å®šæ¨¡å¼

```json
{
  "id": "condition1",
  "type": "condition",
  "position": { "x": 250, "y": 450 },
  "data": {
    "label": "èŠ‚ç‚¹æ ‡ç­¾",
    "conditions": [
      { "type": "stat", "target": "hp", "operation": ">", "value": 50 }
    ],
    "conditionLogic": "AND"  // æ¡ä»¶é€»è¾‘å…³ç³»: "AND" æˆ– "OR"
  }
}
```

##### éª°ç‚¹åˆ¤å®šæ¨¡å¼

```json
{
  "id": "condition2",
  "type": "condition",
  "position": { "x": 250, "y": 650 },
  "data": {
    "label": "èŠ‚ç‚¹æ ‡ç­¾",
    "conditionMode": "check",
    "checkTarget": "dex",  // æ£€å®šç›®æ ‡å±æ€§
    "checkDice": "1d100"   // æ£€å®šä½¿ç”¨çš„éª°å­
  }
}
```

### 2. Edgesï¼ˆè¿æ¥ï¼‰

è¿æ¥å®šä¹‰äº†èŠ‚ç‚¹ä¹‹é—´çš„æµè½¬å…³ç³»ã€‚

```json
[
  // æ™®é€šè¿æ¥
  { "id": "e1", "source": "èµ·å§‹èŠ‚ç‚¹ID", "target": "ç›®æ ‡èŠ‚ç‚¹ID", "markerEnd": { "type": "arrowclosed" } },
  // é€‰é¡¹è¿æ¥ï¼ˆæŒ‡å®šé€‰é¡¹IDï¼‰
  { "id": "e2", "source": "choice1", "sourceHandle": "opt1", "target": "story2", "markerEnd": { "type": "arrowclosed" } },
  // åˆ¤å®šç»“æœè¿æ¥
  { "id": "e3", "source": "condition2", "sourceHandle": "success", "target": "story3", "markerEnd": { "type": "arrowclosed" } }
]
```

**SourceHandle è¯´æ˜ï¼š**
- æ™®é€šè¿æ¥ï¼šæ— éœ€æŒ‡å®š `sourceHandle`
- é€‰é¡¹è¿æ¥ï¼š`sourceHandle` ä¸ºé€‰é¡¹çš„ `id`
- åˆ¤å®šç»“æœè¿æ¥ï¼š
  - é€»è¾‘åˆ¤å®šï¼š`true` æˆ– `false`
  - éª°ç‚¹åˆ¤å®šï¼š`great_success`ï¼ˆå¤§æˆåŠŸï¼‰ã€`success`ï¼ˆæˆåŠŸï¼‰ã€`failure`ï¼ˆå¤±è´¥ï¼‰ã€`great_failure`ï¼ˆå¤§å¤±è´¥ï¼‰

### 3. Settingsï¼ˆè®¾ç½®ï¼‰

åŒ…å«æ’ä»¶ä¿¡æ¯å’Œå…¨å±€éª°ç‚¹è§„åˆ™é…ç½®ã€‚

```json
{
  "pluginName": "æ’ä»¶åç§°",
  "commandName": "è§¦å‘æŒ‡ä»¤",
  "version": "1.0.0",
  "author": "ä½œè€…å",
  "description": "æ’ä»¶æè¿°",
  "homepage": "é¡¹ç›®é“¾æ¥",
  "diceRules": {
    "defaultDice": "1d100",       // é»˜è®¤æ£€å®šéª°å­
    "successMode": "lte",         // æˆåŠŸåˆ¤å®šæ¨¡å¼: "lte"(â‰¤) æˆ– "gte"(â‰¥)
    "criticalSuccess": 5,          // å¤§æˆåŠŸé˜ˆå€¼
    "criticalFailure": 96,         // å¤§å¤±è´¥é˜ˆå€¼
    "criticalSuccessMode": "lte", // å¤§æˆåŠŸåˆ¤å®šæ¨¡å¼
    "criticalFailureMode": "gte"  // å¤§å¤±è´¥åˆ¤å®šæ¨¡å¼
  }
}
```

## é…ç½®ç¤ºä¾‹

å®Œæ•´çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹è¯·æŸ¥çœ‹ `public/example_complex.json` æ–‡ä»¶ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License
